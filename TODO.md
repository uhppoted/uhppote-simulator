# TODO

- [x] set-pc-control
      - [x] handle request/response
      - [x] checked 'touched' time for swipe events

- [x] card + PIN
      - [ ] Controller weirdness when handling of PINs greater than 999999
            - Between 1000000 and 1048576 PIN is set to 0
            - Seems to just drop the most signicant nibble when the PIN >= 1048577
            - 999999  => 0x0F423F (stored as 0x000000)
            - 1000000 => 0x0F4240 (stored as 0x000000)
            - 1000001 => 0x0F4241 (stored as 0x000000)
            - 1048576 => 0x100000 (stored as 0x000000)
            - 1048577 => 0x100001 (stored as 0x000001)
            - 1999999 => 0x1E847F (stored as 0x0E847F)
            - probably just short-circuited byte-by-byte (nibble-by-nibble ? BCD?) equals
            - or maybe just masks out the most significant nibble ?

```
./bin/uhppote-cli --debug put-card 423187757 8000001 2023-01-01 2023-12-31 1,2 1999999
 ... sent 64 bytes to 192.168.1.255:60000

 ... request
 ...          00000000  17 50 00 00 2d 55 39 19  01 12 7a 00 20 23 01 01  |.P..-U9...z. #..|
 ...          00000010  20 23 12 31 01 01 00 00  7f 84 1e 00 00 00 00 00  | #.1............|
 ...          00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...          00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...

 ... received 64 bytes from 192.168.1.101:60000
 ... response
 ...          00000000  17 50 00 00 2d 55 39 19  01 00 00 00 00 00 00 00  |.P..-U9.........|
 ...          00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...          00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...          00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...
```
```
./bin/uhppote-cli --debug get-card 423187757 8000001

 ... sent 64 bytes to 192.168.1.255:60000

 ... request
 ...          00000000  17 5a 00 00 2d 55 39 19  01 12 7a 00 00 00 00 00  |.Z..-U9...z.....|
 ...          00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...          00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...          00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...

 ... received 64 bytes from 192.168.1.101:60000
 ... response
 ...          00000000  17 5a 00 00 2d 55 39 19  01 12 7a 00 20 23 01 01  |.Z..-U9...z. #..|
 ...          00000010  20 23 12 31 01 01 00 00  7f 84 0e 00 00 00 00 00  | #.1............|
 ...          00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...          00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 ...
423187757  8000001  2023-01-01 2023-12-31 Y Y N N 951423
```

- [ ] Only allow valid Wiegand-26 cards
```
8165537  2021-01-01 2021-12-31 Y N N N
8165539  2021-01-01 2021-12-31 N N N N
8165538  2023-01-01 2023-12-31 Y N Y 29 7531
192837465 2023-01-01 2023-12-31 Y N 55 Y 7531
```

## TODO

- [ ] Reimplement event list as circular buffer
- [ ] Verify fields in listen events/status replies against SDK
      - Battery status can be (at least) 0x00, 0x01 and 0x04
- [ ] Emulate PIN pad
- [ ] Replace UTO311L04.TimeOffset with time zone
- [ ] Unit tests for TaskList

### simulator
- [ ] concurrent requests
- [ ] simulator-cli
- [ ] Restructure so that events are generated by the simulator i.e. not by the actions
- [ ] HTML
- [ ] httpd
- [ ] Rework simulator.run to use rx channels
- [ ] Reload simulator on device file change
- [ ] Implement JSON unmarshal to initialise default values
- [ ] Swagger UI
- [ ] Autodetect gzipped files 
      - https://stackoverflow.com/questions/28309988/how-to-read-from-either-gzip-or-plain-text-reader-in-golang

### Documentation

- [ ] godoc
- [ ] build documentation
- [ ] install documentation
- [ ] user manuals
- [ ] man/info page

### Other

1.  Integration tests
